//* üíæ db üíæ *//

datasource db {
  provider     = "mysql"
  relationMode = "prisma"
  url          = env("DATABASE_URL")
}

//* üé∞ generators üé∞ *//

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["filteredRelationCount"]
}

generator kysely {
  provider = "prisma-kysely"
  output   = "../kysely"
  fileName = "kysely.types.ts"
}

//* üíÅ‚Äç‚ôÇÔ∏è users üíÅ‚Äç‚ôÄÔ∏è *//

model User {
  id                   String                 @id @default(cuid())
  // clerkId       String  @unique  
  firstName            String?
  lastName             String?
  fullName             String?
  username             String?                @unique
  email                String                 @unique /// @zod.email()
  emailVerified        DateTime?
  phone                String?                @unique
  phoneVerified        DateTime?
  image                String?
  // sessions             Session[]
  // collabs 
  teams                TeamMember[]           @relation("UserToTeamMember")
  organizations        OrganizationMember[]   @relation("UserToOrganizationMember")
  // public metadata
  type                 UserType
  marketing            Boolean                @default(false)
  // private metadata
  stripeId             String?
  pitchScreening       Boolean?               @default(false)
  pitchReviewing       Boolean?               @default(false)
  // transactions
  transactions         Transaction[]          @relation("UserToTransaction")
  // external accounts
  accounts             Account[]              @relation("UserAccount")
  // assets
  createdFiles         File[]                 @relation("FileCreatedByUser")
  vidRenders           VidRender[]            @relation("VidRenderCreatedByUser")
  trackRenders         TrackRender[]          @relation("TrackRenderCreatedByUser")
  playlistCoverRenders PlaylistCoverRender[]  @relation("PlaylistCoverRenderCreatedByUser")
  // campaigns
  playlistPitchReviews PlaylistPitchReview[]  @relation("PitchReviewCreatedByUser")
  campaignsCreated     Campaign[]             @relation("CampaignCreatedByUser")
  campaignUpdates      CampaignUpdateRecord[] @relation("UserToCampaignUpdateRecord")
  // dev  
  epicsCreated         Epic[]                 @relation("EpicCreatedByUser")
  epicsAssigned        Epic[]                 @relation("EpicAssignedToUser")
  storyBoardsCreated   StoryBoard[]           @relation("StoryBoardCreatedByUser")
  storyBoardsAssigned  StoryBoard[]           @relation("StoryBoardAssignedToUsers")
  storiesCreated       Story[]                @relation("StoryCreatedByUser")
  storiesAssigned      Story[]                @relation("StoryAssignedToUser")
  tasksCreated         Task[]                 @relation("TaskCreatedByUser")
  tasksAssigned        Task[]                 @relation("TaskAssignedToUser")
}

enum UserType {
  label
  artist
  manager
  creator
  influencer
  marketer
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@id([identifier, token])
}

//* üë´ teams üë´ *//

model Team {
  id                   String                @id @default(cuid())
  name                 String
  handle               String                @unique
  createdAt            DateTime              @default(now())
  members              TeamMember[]          @relation("TeamToTeamMember")
  // accounts
  accounts             Account[]             @relation("TeamAccount")
  defaultAccounts      Account[]             @relation("TeamDefaultAccount")
  // links
  links                Link[]                @relation("TeamLink")
  socialLinks          Link[]                @relation("TeamSocialLink")
  analyticsEndpoints   AnalyticsEndpoint[]   @relation("TeamAnalyticsEndpoint")
  externalWebsites     ExternalWebsite[]     @relation("TeamExternalWebsite")
  // bio
  bios                 Bio[]                 @relation("TeamBio")
  rootBio              Bio?                  @relation("TeamRootBio")
  buttons              Button[]              @relation("TeamButton")
  forms                Form[]                @relation("TeamForm")
  // campaigns
  adCreatives          AdCreative[]          @relation("TeamAdCreative")
  // targeting
  audiences            Audience[]            @relation("TeamAudience")
  demos                Demo[]                @relation("TeamDemo")
  geoGroups            GeoGroup[]            @relation("TeamGeoGroup")
  interestGroups       InterestGroup[]       @relation("TeamInterestGroup")
  vidViewsGroups       VidViewsGroup[]       @relation("TeamVidViewsGroup")
  // dev
  epics                Epic[]                @relation("TeamEpic")
  storyBoards          StoryBoard[]          @relation("TeamStoryBoard")
  tasks                Task[]                @relation("TeamTask")
  // assets
  spotifyArtistId      String?               @unique
  tracks               Track[]               @relation("TeamTrack")
  playlists            Playlist[]            @relation("TeamPlaylist")
  files                File[]                @relation("TeamFile")
  trackRenders         TrackRender[]         @relation("TeamToTrackRender")
  vidRenders           VidRender[]           @relation("TeamToVidRender")
  playlistCoverRenders PlaylistCoverRender[] @relation("TeamToPlaylistCoverRender")

  @@unique([id, handle])
}

enum TeamType {
  artist
  creator
  influencer
  product
}

model TeamMember {
  user   User   @relation("UserToTeamMember", fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  userId String
  team   Team   @relation("TeamToTeamMember", fields: [teamId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  teamId String

  role TeamRoleOption @default(member)

  @@id([userId, teamId])
  @@index([userId])
  @@index([teamId])
}

enum TeamRoleOption {
  owner
  admin
  member
}

//* üè∞ organizations üè∞ *//

model Organization {
  id        String               @id @default(cuid())
  name      String
  createdAt DateTime             @default(now())
  members   OrganizationMember[] @relation("OrganizationToOrganizationMember")
}

enum OrganizationType {
  label
  agency
}

model OrganizationMember {
  user   User                   @relation("UserToOrganizationMember", fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  userId String
  org    Organization           @relation("OrganizationToOrganizationMember", fields: [orgId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  orgId  String
  role   OrganizationRoleOption @default(member)

  @@id([userId, orgId])
  @@index([userId])
  @@index([orgId])
}

enum OrganizationRoleOption {
  admin
  member
}

//* üì≤ external accounts üì≤ *//

enum AccountPlatform {
  discord
  facebook
  facebookPage
  github
  google
  metaAd
  metaBusiness
  spotify
  tiktok
  twitch
  twitter
  whatsapp
}

enum OAuthProvider {
  discord
  facebook
  google
  spotify
  tiktok
}

model Account {
  id     String @id @default(cuid())
  user   User   @relation("UserAccount", fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  userId String @unique

  type              String
  platform          AccountPlatform?
  provider          OAuthProvider?
  providerAccountId String?          @unique
  refresh_token     String?          @db.Text
  access_token      String?          @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?          @db.Text
  id_token          String?          @db.Text
  session_state     String?

  username String?
  email    String?
  image    String?

  parentAccount   Account?  @relation("AccountParentChild", fields: [parentAccountId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  parentAccountId String?
  childAccounts   Account[] @relation("AccountParentChild")

  team             Team?   @relation("TeamAccount", fields: [teamId], references: [id], onDelete: SetNull, onUpdate: Cascade)
  teamId           String?
  defaultForTeam   Team?   @relation("TeamDefaultAccount", fields: [defaultForTeamId], references: [id], onDelete: SetNull, onUpdate: Cascade)
  defaultForTeamId String?

  // assets
  appleMusicPlaylists Playlist[] @relation("PlaylistAppleMusicAccount")
  deezerPlaylists     Playlist[] @relation("PlaylistDeezerAccount")
  soundCloudPlaylists Playlist[] @relation("PlaylistSoundCloudAccount")
  spotifyPlaylists    Playlist[] @relation("PlaylistSpotifyAccount")
  tidalPlaylists      Playlist[] @relation("PlaylistTidalAccount")
  youtubePlaylists    Playlist[] @relation("PlaylistYoutubeAccount")

  metaAdCreative    AdCreative[] @relation("AdCreativeMetaAccount")
  metaAdCampaigns   AdCampaign[] @relation("AdCampaignMetaAccount")
  tiktokAdCreative  AdCreative[] @relation("AdCreativetiktokAccount")
  tiktokAdCampaigns AdCampaign[] @relation("AdCampaigntiktokAccount")

  stats Stat[]

  @@unique([defaultForTeamId, platform])
  @@unique([provider, providerAccountId])
  @@unique([id, platform])
  @@unique([id, userId])
  @@unique([userId, provider, id])
  @@index([userId])
  @@index([teamId])
  @@index([parentAccountId])
}

//* üîó links üîó *// 

model Link {
  id                String     @id @default(cuid())
  createdAt         DateTime   @default(now())
  // team
  team              Team       @relation("TeamLink", fields: [teamId, handle], references: [id, handle], onDelete: Cascade, onUpdate: Cascade)
  teamId            String     @default("default")
  socialForTeam     Team?      @relation("TeamSocialLink", fields: [socialForTeamId], references: [id], onDelete: SetNull, onUpdate: Cascade)
  socialForTeamId   String?
  showSocialForTeam Boolean?   @default(true)
  // trigger
  handle            String // from user üëÜ
  domain            LinkDomain @default(barely)
  slug              String?
  app               AppType? // 
  appRoute          String?
  appId             String?
  // target
  url               String     @db.VarChar(1000)
  appleScheme       String?    @db.VarChar(1000)
  androidScheme     String?    @db.VarChar(1000)
  // metadata
  ogTitle           String?
  ogDescription     String?
  ogImage           String?
  favicon           String?
  // qr
  qrLight           String?    @default("white")
  qrDark            String?    @default("black")
  qrText            String?    @default("black")
  qrLogo            String?
  // assets
  appleMusicTrack   Track?     @relation("TrackAppleMusicLink")
  deezerTrack       Track?     @relation("TrackDeezerLink")
  soundcloudTrack   Track?     @relation("TrackSoundcloudLink")
  spotifyTrack      Track?     @relation("TrackSpotifyLink")
  tidalTrack        Track?     @relation("TrackTidalLink")
  youtubeTrack      Track?     @relation("TrackYoutubeLink")

  playlist    Playlist?    @relation("PlaylistLink", fields: [playlistId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  playlistId  String?      @unique
  // bio
  bio         Bio?         @relation("LinkToBio", fields: [bioId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  bioId       String?      @unique
  buttons     Button[]     @relation("LinkToButton")
  // short -> app link
  shortLink   Link?        @relation("ShortToAppLink")
  appLink     Link?        @relation("ShortToAppLink", fields: [appLinkId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  appLinkId   String?      @unique
  // ads
  adCreatives AdCreative[]
  // events    
  events      Event[]

  delete Boolean? @default(false)

  @@unique([socialForTeamId, app])
  @@unique([id, app])
  @@unique([handle, domain, app, slug])
  @@index([teamId, handle])
}

enum AppType {
  appleMusic
  email
  facebook
  instagram
  patreon
  snapchat
  spotify
  tiktok
  twitch
  twitter
  web
  whatsapp
  youtube
}

enum LinkDomain {
  barely
  brl
}

model AnalyticsEndpoint {
  id           String
  team         Team              @relation("TeamAnalyticsEndpoint", fields: [teamId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  teamId       String
  platform     AnalyticsPlatform
  accessToken  String? // ideally this won't be needed
  eventReports EventReport[]     @relation("AnalyticsEndpointToEventReport")

  @@id([platform, id])
  @@unique([teamId, platform, id])
  @@index([teamId])
}

enum AnalyticsPlatform {
  meta
  google
  tiktok
  snapchat
}

//* üë©‚Äçüé§ bio üë©‚Äçüé§ *//

model Bio {
  id                String       @id @default(cuid())
  createdAt         DateTime     @default(now())
  // team
  team              Team         @relation("TeamBio", fields: [teamId, handle], references: [id, handle], onDelete: Cascade, onUpdate: Cascade)
  teamId            String
  rootForTeam       Team?        @relation("TeamRootBio", fields: [rootForTeamId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  rootForTeamId     String?      @unique
  // üîó trigger [handle].barely.bio/[route || slug]/[slug?]
  handle            String // handle pulled from team üëÜ  
  route             String?
  slug              String?
  // üîó alias ([handle].brl.to/[slug] -> [handle].barely.bio/[...path])
  link              Link?        @relation("LinkToBio")
  // analytics
  events            Event[]      @relation("BioToEvent")
  // header
  img               String?
  imgShape          BioImgShape?
  title             String?
  subtitle          String?
  titleColor        String?
  // buttons
  buttons           BioButton[]  @relation("BioToButton")
  buttonColor       String?
  iconColor         String?
  textColor         String?
  // social - buttons pulled from Artist    
  socialDisplay     Boolean
  socialButtonColor String?
  socialIconColor   String?
  // style
  theme             BioTheme
  barelyBranding    Boolean      @default(true)

  @@unique([teamId, route, slug])
  @@index([teamId])
  @@index([handle])
  @@index([teamId, handle])
}

enum BioTheme {
  light
  dark
  app
}

enum BioImgShape {
  square
  circle
  rounded
}

model Button {
  id          String      @id @default(cuid())
  team        Team        @relation("TeamButton", fields: [teamId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  teamId      String
  // content 
  text        String?
  buttonColor String?
  textColor   String?
  // bio
  bios        BioButton[] @relation("ButtonToBio")
  // events    
  link        Link?       @relation("LinkToButton", fields: [linkId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  linkId      String?
  form        Form?       @relation(fields: [formId], references: [id])
  formId      String?
  email       String?     @db.VarChar(1000) /// @zod.email()
  phone       String?

  @@index([formId])
  @@index([teamId])
  @@index([linkId])
}

model BioButton {
  bio            Bio     @relation("BioToButton", fields: [bioId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  bioId          String
  button         Button  @relation("ButtonToBio", fields: [buttonId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  buttonId       String
  lexoRank       String
  buttonLexoRank String
  events         Event[] @relation("BioButtonToEvent")

  @@id([bioId, buttonId])
  @@index([bioId])
  @@index([buttonId])
}

model Form {
  id              String       @id @default(cuid())
  platform        FormPlatform
  // standard
  title           String?
  subtitle        String?
  messagePrompt   String?
  forwardingEmail String /// @zod.email()
  forwardingCc    String // comma separated
  // toggles
  inputName       Boolean
  inputEmail      Boolean
  inputPhone      Boolean
  inputMessage    Boolean

  events    Event[]
  buttons   Button[]
  responses FormResponse[] @relation("FormToFormResponse")

  team   Team   @relation("TeamForm", fields: [teamId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  teamId String

  @@index([teamId])
}

enum FormPlatform {
  bio
  meta
}

model FormResponse {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())

  form    Form    @relation("FormToFormResponse", fields: [formId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  formId  String
  name    String?
  email   String?
  phone   String?
  message String?

  @@index([formId])
}

//* üèÑ campaigns üèÑ *//

model Campaign {
  id                   String                 @id @default(cuid())
  createdAt            DateTime               @unique @default(now())
  type                 CampaignType
  stage                CampaignStage
  endDate              DateTime?
  // user
  createdBy            User?                  @relation("CampaignCreatedByUser", fields: [createdById], references: [id], onDelete: SetNull, onUpdate: Cascade)
  createdById          String?
  // promoting
  track                Track?                 @relation(fields: [trackId], references: [id])
  trackId              String?
  playlist             Playlist?              @relation(fields: [playlistId], references: [id])
  playlistId           String?
  // ads
  adCampaigns          AdCampaign[]
  // results
  screeningMessage     String?
  curatorReach         Int?
  playlistPitchReviews PlaylistPitchReview[]  @relation("CampaignPitchReview")
  updates              CampaignUpdateRecord[]
  // transaction
  lineItems            LineItem[]

  // @@index([teamId])
  @@index([createdById])
  @@index([trackId])
  @@index([playlistId])
}

enum CampaignType {
  // pitch
  playlistPitch
  // spark
  fbSpark
  igSpark
  tiktokSpark
  playlistSpark
  gigSpark
  // charge
  fbCharge
  igCharge
  spotifyCharge
}

enum CampaignStage {
  // pitch
  screening
  rejected
  approved
  // ads
  queuedForTesting
  errorInTestingQueue
  testing
  testingComplete
  // all
  running
  paused
  complete
}

enum CampaignRejectReason {
  spam
  // pitch
  genreFit
  energyFit
  writingFit
  qualityFit
}

model CampaignUpdateRecord {
  id               String         @id @default(cuid())
  createdAt        DateTime       @default(now())
  createdBy        User?          @relation("UserToCampaignUpdateRecord", fields: [createdById], references: [id], onDelete: SetNull, onUpdate: Cascade)
  createdById      String?
  campaign         Campaign       @relation(fields: [campaignId], references: [id])
  campaignId       String
  // changes
  stage            CampaignStage?
  screeningMessage String?
  curatorReach     Int?
  // dailyBudget                   Decimal?       @db.Decimal(10, 2)
  // metaFraction                     Decimal?       @db.Decimal(10, 1)
  // tiktokFraction                   Decimal?       @db.Decimal(10, 1)
  // triggerFraction                  Decimal?       @db.Decimal(10, 1)
  // // projections
  // projectedCostPerMetric           Decimal?       @db.Decimal(10, 3)
  // projectedMonthlyMetric           Int?
  // projectedMonthlyAdSpend          Int?
  // projectedMonthlyMaintenanceSpend Int?
  // projectedMonthlyTotalSpend       Int?
  // projectedMonthlyRevenue          Int?
  // projectedMonthlyNet              Int?

  @@index([campaignId])
  @@index([createdById])
}

//* üì¢ pitch campaigns üì¢ *//

model PlaylistPitchReview {
  id           String              @id @default(cuid())
  createdAt    DateTime            @unique @default(now())
  campaign     Campaign?           @relation("CampaignPitchReview", fields: [campaignId], references: [id], onUpdate: Cascade, onDelete: SetNull)
  campaignId   String?
  // review
  reviewer     User?               @relation("PitchReviewCreatedByUser", fields: [reviewerId], references: [id], onUpdate: Cascade, onDelete: SetNull)
  reviewerId   String?
  // 
  stage        PitchReviewStage
  expiresAt    DateTime
  review       String              @db.LongText
  rating       Int
  rejectReason String?
  placements   PlaylistPlacement[]

  @@unique([id, reviewerId])
  @@unique([campaignId, reviewerId])
  @@index([campaignId])
  @@index([reviewerId])
}

enum PitchReviewStage {
  reviewing
  placed
  rejected
  expired
}

model PlaylistPlacement {
  id               String               @id @default(cuid())
  track            Track                @relation(fields: [trackId], references: [id])
  trackId          String
  pitchReview      PlaylistPitchReview? @relation(fields: [pitchReviewId], references: [id])
  pitchReviewId    String?
  playlist         Playlist             @relation(fields: [playlistId], references: [id])
  playlistId       String
  playlistPosition Int?
  addDate          DateTime?            @default(now())
  daysInPlaylist   Int?
  removeDate       DateTime?

  addedToPlaylist     Boolean @default(false)
  removedFromPlaylist Boolean @default(false)

  @@index([pitchReviewId])
  @@index([playlistId])
  @@index([trackId])
}

//* üì∫ ad campaigns üì∫ *//

model AdCampaign {
  id                       String                @id @default(cuid())
  name                     String
  createdAt                DateTime              @default(now())
  // campaign   
  campaign                 Campaign              @relation(fields: [campaignId], references: [id])
  campaignId               String
  // dates
  startDate                DateTime
  endDate                  DateTime?
  // account
  metaAdAccount            Account               @relation("AdCampaignMetaAccount", fields: [metaAdAccountId], references: [id])
  metaAdAccountId          String
  tiktokAdAccount          Account               @relation("AdCampaigntiktokAccount", fields: [tiktokAdAccountId], references: [id])
  tiktokAdAccountId        String
  // id
  metaId                   String?
  tiktokId                 String?
  // daily budget
  metaDailyBudget          Int?
  tiktokDailyBudget        Int?
  // lifetime budget
  totalLifetimeBudget      Int?
  metaLifetimeBudget       Int?
  tiktokLifetimeBudget     Int?
  // trigger fraction
  metaTriggerFraction      Decimal?              @db.Decimal(10, 1)
  tiktokTriggerFraction    Decimal?              @db.Decimal(10, 1)
  // testing
  testDemos                Demo[]
  testGeoGroups            GeoGroup[]
  testInterestGroups       InterestGroup[]
  testHeadlines            Headline[]
  testVidRenders           VidRender[]
  testTrackRenders         TrackRender[]
  testPlaylistCoverRenders PlaylistCoverRender[]
  // splitTest
  splitTestDemos           Boolean               @default(false)
  splitTestGeoGroups       Boolean               @default(false)
  splitTestInterestGroups  Boolean               @default(false)
  // children
  adSets                   AdSet[]
  // state    
  status                   AdStatus

  @@index([campaignId])
  @@index([metaAdAccountId])
  @@index([tiktokAdAccountId])
}

enum AdStatus {
  ACTIVE
  PAUSED
  ERROR
}

model AdSet {
  id                  String              @id @default(cuid())
  createdAt           DateTime            @default(now())
  // ad campaign
  adCampaign          AdCampaign          @relation(fields: [adCampaignId], references: [id])
  adCampaignId        String
  // targeting
  audience            Audience            @relation(fields: [audienceId], references: [id])
  audienceId          String
  //children
  ads                 Ad[]
  // update
  updates             AdSetUpdateRecord[]
  // clone
  parentAdSetForClone AdSetCloneRecord[]  @relation("ParentAdSetForClone")
  childAdSetFromClone AdSetCloneRecord[]  @relation("ChildAdSetFromClone")
  // id
  metaId              String?
  tiktokId            String?
  // facebook
  fbFeed              Boolean // feed
  fbVideoFeeds        Boolean // video_feeds
  fbMarketplace       Boolean // marketplace
  fbStories           Boolean // story
  // instagram
  igFeed              Boolean // stream
  igStories           Boolean // story
  igReels             Boolean // reels
  // tiktok
  tiktokFeed          Boolean
  // state
  metaStatus          AdStatus
  tiktokStatus        AdStatus

  @@index([adCampaignId])
  @@index([audienceId])
}

model AdSetUpdateRecord {
  id             String    @id @default(cuid())
  createdAt      DateTime  @default(now())
  adSet          AdSet     @relation(fields: [adSetId], references: [id])
  adSetId        String
  // action    
  metaComplete   Boolean?
  tiktokComplete Boolean?
  // props
  status         AdStatus
  dailyBudget    Decimal?  @db.Decimal(10, 2)
  audience       Audience? @relation(fields: [audienceId], references: [id])
  audienceId     String?

  @@index([adSetId])
  @@index([audienceId])
}

model AdSetCloneRecord {
  id             String    @id @default(cuid())
  createdAt      DateTime  @default(now())
  parentAdSet    AdSet     @relation("ParentAdSetForClone", fields: [parentAdSetId], references: [id])
  parentAdSetId  String
  // action    
  meta           Boolean
  metaComplete   Boolean
  tiktok         Boolean
  tiktokComplete Boolean
  // props
  status         AdStatus
  dailyBudget    Decimal?  @db.Decimal(10, 2)
  audience       Audience? @relation(fields: [audienceId], references: [id])
  audienceId     String?
  // child
  childAdSet     AdSet?    @relation("ChildAdSetFromClone", fields: [childAdSetId], references: [id])
  childAdSetId   String?

  @@index([parentAdSetId])
  @@index([audienceId])
  @@index([childAdSetId])
}

model AdCreative {
  id               String    @id @default(cuid())
  name             String
  createdAt        DateTime  @default(now())
  team             Team      @relation("TeamAdCreative", fields: [teamId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  teamId           String
  // account
  metaAccount      Account   @relation("AdCreativeMetaAccount", fields: [metaAccountId], references: [id])
  metaAccountId    String
  tiktokAccount    Account?  @relation("AdCreativetiktokAccount", fields: [tiktokAccountId], references: [id])
  tiktokAccountId  String?
  // id
  metaId           String?
  metaPostId       String?
  tiktokId         String?
  // creative
  headline         Headline? @relation(fields: [headlineId], references: [id])
  headlineId       String?
  vids             File[]
  callToActionType String?
  link             Link      @relation(fields: [linkId], references: [id])
  linkId           String
  linkCaption      String?
  urlTags          String?
  // children
  ads              Ad[]

  @@index([teamId])
  @@index([metaAccountId])
  @@index([tiktokAccountId])
  @@index([headlineId])
  @@index([linkId])
}

model Headline {
  id              String       @id @default(cuid())
  createdAt       DateTime     @default(now())
  headline        String
  adCreatives     AdCreative[]
  adCampaignTests AdCampaign[]
}

model Ad {
  id         String     @id @default(cuid())
  createdAt  DateTime   @default(now())
  // ad set
  adSet      AdSet      @relation(fields: [adSetId], references: [id])
  adSetId    String
  // id
  metaId     String?
  tiktokId   String?
  // creative
  creative   AdCreative @relation(fields: [creativeId], references: [id])
  creativeId String
  // state
  status     AdStatus
  passedTest Boolean?

  stats Stat[]

  @@index([adSetId])
  @@index([creativeId])
}

//* üéØ targeting üéØ *//

model Audience {
  id                     String          @id @default(cuid())
  createdAt              DateTime        @default(now())
  name                   String?
  team                   Team            @relation("TeamAudience", fields: [teamId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  teamId                 String
  // demo
  demo                   Demo            @relation(fields: [demoId], references: [id])
  demoId                 String
  // geo
  geoGroups              GeoGroup[]
  // interests    
  includeInterestGroups  InterestGroup[] @relation("TargetIncludeInterestGroups")
  excludeInterestGroups  InterestGroup[] @relation("TargetExcludeInterestGroups")
  // custom
  includeVidViewsGroups  VidViewsGroup[] @relation("TargetIncludeVidViewsGroup")
  excludeVidViewsGroups  VidViewsGroup[] @relation("TargetExcludeVidViewsGroup")
  // meta
  metaId                 String?
  metaAudienceLowerBound Int?
  metaAudienceUpperBound Int?
  // tiktok
  tiktokId               String?

  adSets          AdSet[]
  forAdSetClones  AdSetCloneRecord[]
  forAdSetUpdates AdSetUpdateRecord[]

  @@index([teamId])
  @@index([demoId])
}

model Demo {
  id          String  @id @default(cuid())
  name        String
  ageMin      Int     @default(18)
  ageMax      Int
  gender      Gender
  onlyEnglish Boolean

  team   Team?   @relation("TeamDemo", fields: [teamId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  teamId String?
  public Boolean @default(false)

  audiences   Audience[]
  adCampaigns AdCampaign[]

  @@index([teamId])
}

enum Gender {
  male
  female
  all
}

model GeoGroup {
  id        String    @id @default(cuid())
  name      String
  countries Country[]

  team   Team?   @relation("TeamGeoGroup", fields: [teamId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  teamId String?
  public Boolean @default(false)

  audiences       Audience[]
  adCampaignTests AdCampaign[]

  @@index([teamId])
}

model Country {
  id                     String           @id
  name                   String
  code                   String
  color                  CountryColorCode
  trigger                Boolean
  metaAudienceLowerBound Int?
  metaAudienceUpperBound Int?
  geoGroups              GeoGroup[]
}

enum CountryColorCode {
  red
  orange
  yellow
  green
}

model InterestGroup {
  id          String       @id @default(cuid())
  name        String
  interests   Interest[]
  includeIn   Audience[]   @relation("TargetIncludeInterestGroups")
  excludeIn   Audience[]   @relation("TargetExcludeInterestGroups")
  adCampaigns AdCampaign[]
  team        Team?        @relation("TeamInterestGroup", fields: [teamId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  teamId      String?
  public      Boolean      @default(false)

  @@index([teamId])
}

model Interest {
  id                     String          @id @default(cuid())
  name                   String
  interestGroups         InterestGroup[]
  // meta
  metaId                 String
  metaTopic              String
  metaAudienceLowerBound Int
  metaAudienceUpperBound Int
}

model VidViewsGroup {
  id                     String              @id @default(cuid())
  name                   String
  vids                   File[]
  metric                 VidViewsMetric
  retention              EngagementRetention
  includeInAudiences     Audience[]          @relation("TargetIncludeVidViewsGroup")
  excludeInAudiences     Audience[]          @relation("TargetExcludeVidViewsGroup")
  // meta
  metaId                 String
  metaName               String
  metaAudienceLowerBound Int
  metaAudienceUpperBound Int
  tiktokId               String
  tiktokName             String

  team   Team?   @relation("TeamVidViewsGroup", fields: [teamId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  teamId String?

  @@index([teamId])
}

enum VidViewsMetric {
  view_1s
  view_15s
  view_60s
}

enum EngagementRetention {
  day_1
  day_3
  day_7
  day_30
  day_365
}

//* üìà analytics üìà *//

model VisitorSession {
  id                String           @id @default(cuid())
  createdAt         DateTime         @default(now())
  events            Event[]
  externalWebsite   ExternalWebsite? @relation(fields: [externalWebsiteId], references: [id])
  externalWebsiteId String?
  // user - device
  browserName       String?
  browserVersion    String?
  cpu               String?
  deviceModel       String?
  deviceType        String?
  deviceVendor      String?
  ip                String? // to be anonymized in the future (1d? 1w?)
  isBot             Boolean?
  osName            String?
  osVersion         String?
  referrer          String?
  ua                String?
  // user - geo
  city              String?
  country           String?
  latitude          String?
  longitude         String?
  region            String?

  @@index([externalWebsiteId])
}

model Event {
  id        Int            @id @default(autoincrement())
  type      EventType
  createdAt DateTime       @default(now())
  // link
  link      Link?          @relation(fields: [linkId], references: [id])
  linkId    String?
  // bio
  bio       Bio?           @relation("BioToEvent", fields: [bioId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  bioId     String?
  bioButton BioButton?     @relation("BioButtonToEvent", fields: [bioId, buttonId], references: [bioId, buttonId], onDelete: Cascade, onUpdate: Cascade)
  buttonId  String?
  // form
  form      Form?          @relation(fields: [formId], references: [id])
  formId    String?
  // analytics    
  session   VisitorSession @relation(fields: [sessionId], references: [id])
  sessionId String

  eventReports EventReport[]

  @@index([bioId])
  @@index([bioId, buttonId])
  @@index([formId])
  @@index([sessionId])
  @@index([linkId])
}

enum EventType {
  pageView
  linkClick
  formOpen
  formSubmit
  presaveSpotifyOpen
  presaveSpotifyComplete
}

model EventReport {
  createdAt         DateTime          @default(now())
  // event
  event             Event             @relation(fields: [eventId], references: [id])
  eventId           Int
  // report
  analyticsEndpoint AnalyticsEndpoint @relation("AnalyticsEndpointToEventReport", fields: [analyticsPlatform, analyticsId], references: [platform, id], onDelete: Cascade, onUpdate: Cascade)
  analyticsPlatform AnalyticsPlatform
  analyticsId       String
  // 
  error             String?           @db.VarChar(1000)

  @@id([eventId, analyticsPlatform, analyticsId])
  @@index([eventId])
  @@index([analyticsPlatform, analyticsId])
}

model ExternalWebsite {
  id              String           @id @default(cuid())
  createdAt       DateTime         @default(now())
  name            String
  team            Team?            @relation("TeamExternalWebsite", fields: [teamId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  teamId          String?
  visitorSessions VisitorSession[]

  @@index([teamId])
}

model Stat {
  id           String   @id @default(cuid())
  date         DateTime
  listeners    Int?
  streams      Int?
  likes        Int?
  saves        Int?
  followers    Int?
  newFollowers Int?

  spend       Decimal? @db.Decimal(10, 2)
  clicks      Int?
  impressions Int?

  views    Int?
  watch25  Int?
  watch50  Int?
  watch75  Int?
  watch95  Int?
  watch100 Int?
  watch60s Int?

  // stats for:  
  ad                Ad?                @relation(fields: [adId], references: [id])
  adId              String?
  account           Account?           @relation(fields: [accountId], references: [id])
  accountId         String?
  playlist          Playlist?          @relation(fields: [playlistId], references: [id])
  playlistId        String?
  track             Track?             @relation(fields: [trackId], references: [id])
  trackId           String?
  streamingPlatform StreamingPlatform?

  @@index([adId])
  @@index([accountId])
  @@index([playlistId])
  @@index([trackId])
}

enum StreamingPlatform {
  appleMusic
  spotify
  youtube
}

//* üß∞ dev üß∞ *//  

model Epic {
  id                 String    @id @default(cuid())
  createdAt          DateTime  @default(now())
  name               String
  description        String?
  targetStartDate    DateTime?
  targetCompleteDate DateTime?
  startDate          DateTime?
  color              String?
  complete           Boolean?  @default(false)
  lexoRank           String
  // users 
  createdBy          User?     @relation("EpicCreatedByUser", fields: [createdById], references: [id], onDelete: SetNull, onUpdate: Cascade)
  createdById        String?
  assignedTo         User?     @relation("EpicAssignedToUser", fields: [assignedToId], references: [id], onDelete: SetNull, onUpdate: Cascade)
  assignedToId       String?
  team               Team      @relation("TeamEpic", fields: [teamId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  teamId             String
  // children
  stories            Story[]

  @@index([teamId])
  @@index([createdById])
  @@index([assignedToId])
}

model StoryBoard {
  id          String   @id @default(cuid())
  name        String
  createdAt   DateTime @default(now())
  createdBy   User?    @relation("StoryBoardCreatedByUser", fields: [createdById], references: [id], onDelete: SetNull, onUpdate: Cascade)
  createdById String?
  members     User[]   @relation("StoryBoardAssignedToUsers")

  color   String?
  columns StoryColumn[]

  team   Team   @relation("TeamStoryBoard", fields: [teamId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  teamId String

  @@unique([name, createdById])
  @@index([createdById])
  @@index([teamId])
}

model StoryColumn {
  id           String              @id @default(cuid())
  name         String
  board        StoryBoard          @relation(fields: [boardId], references: [id])
  boardId      String
  lexoRank     String
  stories      Story[]
  prevStoryFor StoryUpdateRecord[] @relation("StoryUpdatePrevColumn")
  newStoryFor  StoryUpdateRecord[] @relation("StoryUpdateNewColumn")

  @@unique([name, boardId])
  @@index([boardId])
}

model Story {
  id          String    @id @default(cuid())
  createdAt   DateTime  @default(now())
  name        String?
  description String?
  dueDate     DateTime?
  lexoRank    String
  priority    String?

  createdBy    User?       @relation("StoryCreatedByUser", fields: [createdById], references: [id], onDelete: SetNull, onUpdate: Cascade)
  createdById  String?
  assignedTo   User?       @relation("StoryAssignedToUser", fields: [assignedToId], references: [id], onDelete: SetNull, onUpdate: Cascade)
  assignedToId String?
  epic         Epic?       @relation(fields: [epicId], references: [id])
  epicId       String?
  column       StoryColumn @relation(fields: [columnId], references: [id])
  columnId     String

  update StoryUpdateRecord[]
  tasks  Task[]

  @@index([createdById])
  @@index([assignedToId])
  @@index([epicId])
  @@index([columnId])
}

model StoryUpdateRecord {
  id           String       @id @default(cuid())
  createdAt    DateTime     @default(now())
  story        Story        @relation(fields: [storyId], references: [id])
  storyId      String
  prevColumn   StoryColumn? @relation("StoryUpdatePrevColumn", fields: [prevColumnId], references: [id])
  prevColumnId String?
  newColumn    StoryColumn? @relation("StoryUpdateNewColumn", fields: [newColumnId], references: [id])
  newColumnId  String?

  @@index([storyId])
  @@index([prevColumnId])
  @@index([newColumnId])
}

model Task {
  id          String    @id @default(cuid())
  createdAt   DateTime  @default(now())
  name        String
  description String?
  dueDate     DateTime?
  lexoRank    String
  priority    String?
  today       Boolean
  complete    Boolean

  team         Team?   @relation("TeamTask", fields: [teamId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  teamId       String?
  createdBy    User?   @relation("TaskCreatedByUser", fields: [createdById], references: [id], onDelete: SetNull, onUpdate: Cascade)
  createdById  String?
  assignedTo   User?   @relation("TaskAssignedToUser", fields: [assignedToId], references: [id], onDelete: SetNull, onUpdate: Cascade)
  assignedToId String?

  story      Story?    @relation(fields: [storyId], references: [id])
  storyId    String?
  delete     Boolean
  deleteDate DateTime?

  @@index([teamId])
  @@index([createdById])
  @@index([assignedToId])
  @@index([storyId])
}

//* üí¨ chat üí¨ *//

// chat
// model ChatChannel {
//   id          String    @id @default(cuid())
//   createdAt   DateTime  @default(now())
//   name        String
//   description String?
//   // creator
//   owner       User      @relation(fields: [ownerId], references: [id])
//   ownerId     String
//   // members
//   members     ChatMember[]
//   // messages
//   messages    ChatMessage[]
//   // campaigns
//   campaigns   Campaign[]

//   @@index([ownerId])
// }

// model ChatThread {
//   id          String    @id @default(cuid())
//   createdAt   DateTime  @default(now())
//   name        String
//   description String?
//   // creator
//   owner       User      @relation(fields: [ownerId], references: [id])
//   ownerId     String
//   // members
//   members     ChatMember[]
//   // messages
//   messages    ChatMessage[]
//   // campaigns
//   campaigns   Campaign[]

//   @@index([ownerId])
// }

// model ChatMember {
//   id          String    @id @default(cuid())
//   createdAt   DateTime  @default(now())
//   // member
//   user        User      @relation(fields: [userId], references: [id])
//   userId      String
//   // channel
//   channel     ChatChannel? @relation(fields: [channelId], references: [id])
//   channelId   String?
//   // thread
//   thread      ChatThread? @relation(fields: [threadId], references: [id])
//   threadId    String?
//   // campaigns
//   campaigns   Campaign[]

//   @@index([userId])
//   @@index([channelId])
//   @@index([threadId])
// }

// model ChatMessage {
//   id          String    @id @default(cuid())
//   createdAt   DateTime  @default(now())
//   text        String
//   // sender
//   user        User      @relation(fields: [userId], references: [id])
//   userId      String
//   // channel
//   channel     ChatChannel? @relation(fields: [channelId], references: [id])
//   channelId   String?
//   // thread
//   thread      ChatThread? @relation(fields: [threadId], references: [id])
//   threadId    String?
//   // campaigns
//   campaigns   Campaign[]

//   @@index([userId])
//   @@index([channelId])
//   @@index([threadId])
// }

// model ChatMessage {
//   id          String    @id @default(cuid())
//   createdAt   DateTime  @default(now())
//   text        String
//   // sender
//   user        User      @relation(fields: [userId], references: [id])
//   userId      String
//   // channel
//   channel     ChatChannel? @relation(fields: [channelId], references: [id])
//   channelId   String?
//   // thread
//   thread      ChatThread? @relation(fields: [threadId], references: [id])
//   threadId    String?
//   // campaigns
//   campaigns   Campaign[]

//   @@index([userId])
//   @@index([channelId])
//   @@index([threadId])
// }

//* üè¶ assets üè¶ *//

model Track {
  id                 String              @id @default(cuid())
  name               String
  team               Team                @relation("TeamTrack", fields: [teamId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  teamId             String
  // external ids
  isrc               String?
  appleMusicId       String?             @unique
  deezerId           String?             @unique
  soundcloudId       String?             @unique
  spotifyId          String?             @unique
  tidalId            String?             @unique
  youtubeId          String?             @unique
  // metadata
  trackGenres        TrackGenre[]
  imageUrl           String?
  released           Boolean
  releaseDate        DateTime?
  // files 
  masterMp3          File?               @relation("TrackMasterMp3", fields: [masterMp3Id], references: [id])
  masterMp3Id        String?             @unique
  masterWav          File?               @relation("TrackMasterWav", fields: [masterWavId], references: [id])
  masterWavId        String?             @unique
  vids               File[]              @relation("TrackVids")
  trackRenders       TrackRender[]
  // links  
  appleMusicLink     Link?               @relation("TrackAppleMusicLink", fields: [appleMusicLinkId], references: [id])
  appleMusicLinkId   String?
  deezerLink         Link?               @relation("TrackDeezerLink", fields: [deezerLinkId], references: [id])
  deezerLinkId       String?
  soundcloudLink     Link?               @relation("TrackSoundcloudLink", fields: [soundcloudLinkId], references: [id])
  soundcloudLinkId   String?
  spotifyLink        Link?               @relation("TrackSpotifyLink", fields: [spotifyLinkId], references: [id])
  spotifyLinkId      String?
  tidalLink          Link?               @relation("TrackTidalLink", fields: [tidalLinkId], references: [id])
  tidalLinkId        String?
  youtubeLink        Link?               @relation("TrackYoutubeLink", fields: [youtubeLinkId], references: [id])
  youtubeLinkId      String?
  // campaigns
  playlistPlacements PlaylistPlacement[]
  campaigns          Campaign[]
  stats              Stat[]

  @@unique([teamId, name])
  @@unique([appleMusicLinkId])
  @@unique([deezerLinkId])
  @@unique([soundcloudLinkId])
  @@unique([spotifyLinkId])
  @@unique([tidalLinkId])
  @@unique([youtubeLinkId])
}

model Playlist {
  id                  String                @id @default(cuid())
  team                Team?                 @relation("TeamPlaylist", fields: [teamId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  teamId              String?
  // accounts
  appleMusicId        String?               @unique
  appleMusicAccount   Account?              @relation("PlaylistAppleMusicAccount", fields: [appleMusicAccountId], references: [id], onDelete: SetNull, onUpdate: Cascade)
  appleMusicAccountId String?
  deezerId            String?               @unique
  deezerAccount       Account?              @relation("PlaylistDeezerAccount", fields: [deezerAccountId], references: [id], onDelete: SetNull, onUpdate: Cascade)
  deezerAccountId     String?
  soundCloudId        String?               @unique
  soundCloudAccount   Account?              @relation("PlaylistSoundCloudAccount", fields: [soundCloudAccountId], references: [id], onDelete: SetNull, onUpdate: Cascade)
  soundCloudAccountId String?
  spotifyId           String?               @unique
  spotifyAccount      Account?              @relation("PlaylistSpotifyAccount", fields: [spotifyAccountId], references: [id], onDelete: SetNull, onUpdate: Cascade)
  spotifyAccountId    String?
  tidalId             String?               @unique
  tidalAccount        Account?              @relation("PlaylistTidalAccount", fields: [tidalAccountId], references: [id], onDelete: SetNull, onUpdate: Cascade)
  tidalAccountId      String?
  youtubeId           String?               @unique
  youtubeAccount      Account?              @relation("PlaylistYoutubeAccount", fields: [youtubeAccountId], references: [id], onDelete: SetNull, onUpdate: Cascade)
  youtubeAccountId    String?
  // metadata
  name                String
  description         String?
  public              Boolean
  userOwned           Boolean
  totalTracks         Int?
  tracklist           Json?
  playlistGenres      PlaylistGenre[]
  // campaigns
  campaigns           Campaign[]
  forTesting          Boolean
  placements          PlaylistPlacement[]
  // artwork
  cover               File?                 @relation(fields: [coverId], references: [id])
  coverId             String?
  imageUrl            String?
  coverRenders        PlaylistCoverRender[]
  // links
  link                Link?                 @relation("PlaylistLink")
  linkId              String?               @unique
  // clones
  cloneChildren       Playlist[]            @relation("PlaylistCloneParent")
  cloneParent         Playlist?             @relation("PlaylistCloneParent", fields: [cloneParentId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  cloneParentId       String?
  // analytics
  stats               Stat[]

  @@index([appleMusicAccountId])
  @@index([deezerAccountId])
  @@index([soundCloudAccountId])
  @@index([spotifyAccountId])
  @@index([tidalAccountId])
  @@index([youtubeAccountId])
  @@index([teamId])
  @@index([coverId])
  @@index([cloneParentId])
}

model Genre {
  name           String          @id
  trackGenres    TrackGenre[]
  playlistGenres PlaylistGenre[]
}

model TrackGenre {
  track     Track  @relation(fields: [trackId], references: [id])
  trackId   String
  genre     Genre  @relation(fields: [genreName], references: [name])
  genreName String

  @@id([trackId, genreName])
  @@index([trackId])
  @@index([genreName])
}

model PlaylistGenre {
  playlist   Playlist @relation(fields: [playlistId], references: [id])
  playlistId String
  genre      Genre    @relation(fields: [genreName], references: [name])
  genreName  String

  @@id([playlistId, genreName])
  @@index([playlistId])
  @@index([genreName])
}

//* üóÑ files üóÑ *//

model File {
  id     String @id @default(cuid())
  team   Team   @relation("TeamFile", fields: [teamId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  teamId String

  createdAt              DateTime             @default(now())
  creator                User?                @relation("FileCreatedByUser", fields: [creatorId], references: [id], onUpdate: NoAction, onDelete: SetNull)
  creatorId              String?
  type                   FileType
  name                   String
  extension              FileExtension
  description            String?
  url                    String
  // props
  size                   Int
  width                  Int?
  height                 Int?
  fps                    Int?
  duration               Int?
  internal               Boolean
  metaId                 String?
  // track
  vidForTrack            Track?               @relation("TrackVids", fields: [vidForTrackId], references: [id], onUpdate: NoAction, onDelete: NoAction)
  vidForTrackId          String?
  masterMp3ForTrack      Track?               @relation("TrackMasterMp3")
  masterWavForTrack      Track?               @relation("TrackMasterWav")
  // playlist
  playlists              Playlist[]
  playlistCoverRender    PlaylistCoverRender? @relation("PlaylistCoverRender")
  // thumbnail
  thumbnail              File?                @relation("FileThumbnail")
  thumbnailFor           File?                @relation("FileThumbnail", fields: [thumbnailForId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  thumbnailForId         String?              @unique
  // vidRender
  vidRender              VidRender?           @relation("VidRender")
  parentVidForVidRenders VidRender[]          @relation("VidRenderParent")
  // adCreative
  adCreatives            AdCreative[]
  // targeting
  vidViewsGroups         VidViewsGroup[] // todo - add back in

  @@index([teamId])
  @@index([creatorId])
  @@index([vidForTrackId])
  @@index([thumbnailForId])
}

enum FileType {
  audio
  video
  image
}

enum FileExtension {
  mp3
  wav
  jpg
  png
  mp4
  mov
}

//* üíΩ renders üíΩ *//

model VidRender {
  id                String       @id @default(cuid())
  createdBy         User?        @relation("VidRenderCreatedByUser", fields: [createdById], references: [id], onUpdate: Cascade, onDelete: SetNull)
  createdById       String?
  team              Team         @relation("TeamToVidRender", fields: [teamId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  teamId            String
  renderStatus      RenderStatus
  renderFailedError String?      @db.VarChar(1000)
  renderedVid       File         @relation("VidRender", fields: [renderedVidId], references: [id])
  renderedVidId     String       @unique
  // parents
  parentVid         File         @relation("VidRenderParent", fields: [parentVidId], references: [id])
  parentVidId       String
  // comp
  compName          String
  compWidth         Int
  compHeight        Int
  compDuration      Int
  // edits
  trim              Boolean
  trimIn            Decimal      @db.Decimal(10, 1)
  trimOut           Decimal      @db.Decimal(10, 1)
  shift             Boolean
  shiftX            Int
  shiftY            Int
  playbackSpeed     Decimal      @db.Decimal(10, 1)
  // composites
  addTrack          Boolean
  trackRender       TrackRender  @relation(fields: [trackRenderId], references: [id])
  trackRenderId     String
  addPlaylistTitle  Boolean
  playlistTitle     String?
  // lambda
  lambdaRenderId    String
  lambdaBucket      String
  lambdaFunction    String
  lambdaRegion      String
  // for
  adCampaign        AdCampaign?  @relation(fields: [adCampaignId], references: [id])
  adCampaignId      String?

  @@index([teamId])
  @@index([createdById])
  // @@index([userId])
  @@index([trackRenderId])
  @@index([parentVidId])
  @@index([adCampaignId])
}

enum RenderStatus {
  queued
  rendering
  failed
  complete
}

model TrackRender {
  id                 String       @id @default(cuid())
  createdBy          User?        @relation("TrackRenderCreatedByUser", fields: [createdById], references: [id], onUpdate: Cascade, onDelete: SetNull)
  createdById        String?
  team               Team         @relation("TeamToTrackRender", fields: [teamId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  teamId             String
  track              Track        @relation(fields: [trackId], references: [id])
  trackId            String
  trackTrimIn        Decimal      @db.Decimal(10, 1)
  testForAdCampaigns AdCampaign[]
  vidRenders         VidRender[]

  @@index([trackId])
  @@index([teamId])
  @@index([createdById])
}

model PlaylistCoverRender {
  id              String       @id @default(cuid())
  name            String?
  createdBy       User?        @relation("PlaylistCoverRenderCreatedByUser", fields: [createdById], references: [id], onUpdate: Cascade, onDelete: SetNull)
  createdById     String?
  team            Team         @relation("TeamToPlaylistCoverRender", fields: [teamId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  teamId          String
  // image
  img             Boolean
  imgSrc          String
  imgShift        Boolean
  imgShiftX       Int
  imgShiftY       Int
  imgScale        Int
  // text
  text            Boolean
  textColor       String       @default("white")
  textScale       Int          @default(100)
  textAlign       String       @default("center")
  textShiftX      Int          @default(0)
  textShiftY      Int          @default(0)
  // logo
  logo            Boolean
  logoColor       String       @default("white")
  // output
  renderedCover   File?        @relation("PlaylistCoverRender", fields: [renderedCoverId], references: [id], onDelete: SetNull, onUpdate: NoAction)
  renderedCoverId String?      @unique
  // playlist
  playlist        Playlist     @relation(fields: [playlistId], references: [id])
  playlistId      String
  // campaigns
  adCampaigns     AdCampaign[]

  renderedPlaylistCoverId String?
  userId                  String?

  @@index([teamId])
  @@index([createdById])
  @@index([playlistId])
}

//* ü§ù transactions ü§ù *//

model Subscription {
  id        String           @id @default(cuid())
  type      SubscriptionType
  lineItems LineItem[]
}

enum SubscriptionType {
  campaignMaintenance
  links
}

model LineItem {
  id             String        @id @default(cuid())
  name           String
  description    String
  campaign       Campaign?     @relation(fields: [campaignId], references: [id])
  campaignId     String?
  subscription   Subscription? @relation(fields: [subscriptionId], references: [id])
  subscriptionId String?

  paymentType                  PaymentType
  setupPrice                   Decimal?    @db.Decimal(10, 2)
  subscriptionPrice            Decimal?    @db.Decimal(10, 2)
  subscriptionPriceDescription String?
  maintenancePrice             String?
  maintenancePriceDescription  String?

  totalDue Decimal? @db.Decimal(10, 2)

  transaction   Transaction? @relation(fields: [transactionId], references: [id])
  transactionId String?

  @@index([campaignId])
  @@index([transactionId])
  @@index([subscriptionId])
}

enum PaymentType {
  oneTime
  subscription
}

model Transaction {
  id                 String            @id @default(cuid())
  createdAt          DateTime          @default(now())
  completedAt        DateTime?
  type               String?
  amount             Decimal           @db.Decimal(10, 2)
  description        String?
  lineItems          LineItem[]
  status             TransactionStatus
  // stripe
  stripeId           String?
  stripeClientSecret String?
  stripeMetadata     Json?
  stripeLiveMode     Boolean           @default(false)
  checkoutLink       String?

  user   User?   @relation("UserToTransaction", fields: [userId], references: [id], onDelete: SetNull, onUpdate: NoAction)
  userId String?

  @@index([userId])
}

enum TransactionStatus {
  created
  pending
  succeeded
  failed
}
